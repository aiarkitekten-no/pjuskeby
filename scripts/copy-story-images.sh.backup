#!/bin/sh
# Copy generated story images from /tmp to public/assets/agatha/story/
# This script is designed to be run with sudo

set -e

SLUG="$1"

if [ -z "$SLUG" ]; then
  echo "Usage: sudo sh scripts/copy-story-images.sh <story-slug>"
  echo "Example: sudo sh scripts/copy-story-images.sh 2025-10-17-event-abc123"
  exit 1
fi

DEST_DIR="/var/www/vhosts/pjuskeby.org/public/assets/agatha/story"

# Create directory if it doesn't exist
mkdir -p "$DEST_DIR"

echo "📦 Copying story images for: $SLUG"

# Copy featured image
if [ -f "/tmp/${SLUG}-featured.png" ]; then
  cp "/tmp/${SLUG}-featured.png" "$DEST_DIR/"
  echo "✓ Copied featured image"
else
  echo "⚠️  Featured image not found: /tmp/${SLUG}-featured.png"
fi

# Copy first inline image
if [ -f "/tmp/${SLUG}-inline1.png" ]; then
  cp "/tmp/${SLUG}-inline1.png" "$DEST_DIR/"
  echo "✓ Copied inline1 image"
else
  echo "⚠️  Inline1 image not found: /tmp/${SLUG}-inline1.png"
fi

# Copy second inline image
if [ -f "/tmp/${SLUG}-inline2.png" ]; then
  cp "/tmp/${SLUG}-inline2.png" "$DEST_DIR/"
  echo "✓ Copied inline2 image"
else
  echo "⚠️  Inline2 image not found: /tmp/${SLUG}-inline2.png"
fi

# Set correct ownership and permissions
chown pjuskebysverden:psacln "$DEST_DIR/${SLUG}"-*.png 2>/dev/null || true
chmod 644 "$DEST_DIR/${SLUG}"-*.png 2>/dev/null || true

echo "✅ Images copied and permissions set!"
echo "📍 Location: $DEST_DIR/"
ls -lh "$DEST_DIR/${SLUG}"-*.png 2>/dev/null || echo "No images found with slug: $SLUG"
